<div class="appointments-container">
  <h1>Mes Rendez-vous</h1>

  <div *ngIf="isLoading" class="loading">Chargement...</div>
  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

  <div *ngIf="!isLoading && !errorMessage" class="appointments-table">
    <mat-table [dataSource]="appointments" class="mat-elevation-z8">
      <ng-container matColumnDef="date">
        <mat-header-cell *matHeaderCellDef>Date</mat-header-cell>
        <mat-cell *matCellDef="let element">{{ element.date_heure | date:'EEEE, dd MMMM yyyy' }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="time">
        <mat-header-cell *matHeaderCellDef>Heure</mat-header-cell>
        <mat-cell *matCellDef="let element">{{ element.date_heure | date:'HH:mm' }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="patient">
        <mat-header-cell *matHeaderCellDef>Patient</mat-header-cell>
        <mat-cell *matCellDef="let element">{{ getPatientName(element) }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="status">
        <mat-header-cell *matHeaderCellDef>Statut</mat-header-cell>
        <mat-cell *matCellDef="let element">{{ getAppointmentStatusLabel(element.statut) }}</mat-cell>
      </ng-container>

      <!-- Nouvelle colonne Actions -->
      <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
        <mat-cell *matCellDef="let element">
          <div class="action-buttons">
            <!-- Bouton Confirmer -->
            <button mat-mini-fab color="primary"
                    *ngIf="element.statut === 'en_attente'"
                    (click)="confirmAppointment(element)"
                    matTooltip="Confirmer le rendez-vous">
              <mat-icon>check</mat-icon>
            </button>

            <!-- Bouton Reporter -->
            <button mat-mini-fab color="accent"
                    *ngIf="element.statut === 'en_attente' || element.statut === 'confirme'"
                    (click)="rescheduleAppointment(element)"
                    matTooltip="Reporter le rendez-vous">
              <mat-icon>event_repeat</mat-icon>
            </button>

            <!-- Bouton Annuler (si vous voulez l'inclure aussi pour les mÃ©decins) -->
            <!-- <button mat-mini-fab color="warn"
                    *ngIf="element.statut !== 'annule' && element.statut !== 'termine'"
                    (click)="cancelAppointment(element)"
                    matTooltip="Annuler le rendez-vous">
              <mat-icon>cancel</mat-icon>
            </button> -->
          </div>
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
    </mat-table>
  </div>
</div>
